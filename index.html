<!doctype html>
<html lang="it">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Inventario</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap"
            rel="stylesheet"
        />
    </head>
    <body>
        <button id="hamburger-btn" title="Menu" style="background-color: rgb(226, 226, 226);">
            <svg height="20px" weight="20px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" fill="#202020" data-darkreader-inline-fill=""><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>category-solid</title> <g id="Layer_2" data-name="Layer 2"> <g id="invisible_box" data-name="invisible box"> <rect width="48" height="48" fill="none"></rect> </g> <g id="icons_Q2" data-name="icons Q2"> <path d="M24,2a2.1,2.1,0,0,0-1.7,1L13.2,17a2.3,2.3,0,0,0,0,2,1.9,1.9,0,0,0,1.7,1H33a2.1,2.1,0,0,0,1.7-1,1.8,1.8,0,0,0,0-2l-9-14A1.9,1.9,0,0,0,24,2Z"></path> <path d="M43,43H29a2,2,0,0,1-2-2V27a2,2,0,0,1,2-2H43a2,2,0,0,1,2,2V41A2,2,0,0,1,43,43Z"></path> <path d="M13,24A10,10,0,1,0,23,34,10,10,0,0,0,13,24Z"></path> </g> </g> </g></svg>
        </button>
        <div id="sidebar-menu">
            <div class="sidebar-header">
                <h1
                    id="sidebar-title"
                    style="margin-top: 0px; margin-left: 50px"
                >
                    INVENTARIO
                </h1>
            </div>
            <div id="sidebar-content-wrapper">
                <div id="sidebar-counters">
                    <p>
                        Totale inventario:
                        <span id="sidebar-total-elements">0</span>
                    </p>
                    <p>
                        Elementi filtrati:
                        <span id="sidebar-filtered-elements">0</span>
                    </p>
                    <p>
                        Selezionati:
                        <span id="sidebar-checked-elements">0</span>
                    </p>
                    <p>
                        Rimanenti:
                        <span id="sidebar-remaining-elements">0</span>
                    </p>
                    <div
                        id="sidebar-inventory-utilizzo-counters"
                        class="utilizzo-summary hidden"
                    >
                        <!-- Contatori utilizzo verranno inseriti qui da JS -->
                    </div>
                </div>
                <div id="sidebar-category-filters" style="padding-top: 20px; padding-left: 5px">
                    <!-- Category filters will be populated by JS -->
                </div>
                <div id="sidebar-controls" style="padding-top: 20px">
                    <!-- Buttons are already defined in HTML and moved here by JS, this div is just a container -->
                    <button id="filter-btn" title="Filtro"></button>
                    <button
                        id="collapse-all-btn"
                        title="Comprimi tutto"
                    ></button>
                    <button id="show-checked-btn" title="Cronologia"></button>
                    <button
                        id="export-checklist-btn"
                        title="Esporta checklist attuale"
                    ></button>
                </div>
            </div>
        </div>

        <div id="initial-sections-wrapper">
            <!-- Wrapper for initial screens -->
            <div id="file-input-section">
                <button id="cancel-change-file-btn" class="hidden" title="Annulla modifica file">×</button>
                <h1>Carica file</h1>
                <div class="file-input-row">
                    <input type="file" id="json-file-input" accept=".json,.csv" />
                    <button id="load-file-btn">Apri</button>
                </div>
                <p id="load-status" class="status"></p>
            </div>

            <div id="confirm-load-section" class="hidden">
<div id="confirm-saved-checklist-section" class="hidden">
                    <h2 style="margin-bottom: 30px">Checklist rilevata</h2>
                    <p style="margin-left: 2px">
                        <strong>Filtro originale applicato:</strong>
                        <span id="saved-original-filters">N/D</span>
                    </p>
                    <p style="margin-left: 2px">
                        <strong>Totale inventario:</strong>
                        <span id="saved-total-items">0</span>
                    </p>
                    <p style="margin-left: 2px">
                        <strong>Elementi spuntati:</strong>
                        <span id="saved-checked-items">0</span>
                    </p>
                    <p style="margin-left: 2px">
                        <strong>Elementi rimanenti:</strong>
                        <span id="saved-remaining-items">0</span>
                    </p>
                    <button
                        id="confirm-load-saved-btn"
                        style="margin-top: 30px; margin-bottom: 20px"
                    >
                        Carica checklist
                    </button>
                </div>
            </div>
        </div>

        <div id="main-content" class="hidden">
            <div id="checklist-container-wrapper">
                <div
                    id="all-items-checked-message"
                    class="hidden"
                    style="
                        text-align: center;
                        padding: 50px 0;
                        font-size: 1.2em;
                        color: #ccc;
                    "
                >
                    Tutti gli elementi spuntati.
                </div>
                <div id="counters" style="display: none">
                    <p>Totale inventario: <span id="total-elements">0</span></p>
                    <p>
                        Elementi filtrati: <span id="filtered-elements">0</span>
                    </p>
                    <p>Selezionati: <span id="checked-elements">0</span></p>
                    <p>Rimanenti: <span id="remaining-elements">0</span></p>
                    <div
                        id="inventory-utilizzo-counters"
                        class="utilizzo-summary hidden"
                        style="display: none"
                    ></div>
                </div>
                <ul id="checklist-container" class="checklist"></ul>
            </div>
        </div>

        <div id="checked-items-overlay" class="hidden">
            <div id="checked-items-modal">
                <div class="modal-header">
                    <h2>Cronologia</h2>
                    <button id="clear-all-checked-btn">RIPRISTINA TUTTO</button>
                </div>
                <ul id="checked-items-list"></ul>
            </div>
        </div>

        <div id="filter-modal-overlay" class="hidden">
            <div id="filter-modal">
                <div class="modal-header">
                    <h2>FILTRO</h2>
                </div>
                <div id="filter-modal-content">
                    <label><input type="checkbox" name="modal-utilizzo-filter" value="Attivo" /> Attivo</label>
                    <label><input type="checkbox" name="modal-utilizzo-filter" value="In uso" /> In uso</label>
                    <label><input type="checkbox" name="modal-utilizzo-filter" value="Archiviato" /> Archiviato</label>
                </div>

            </div>
        </div>

        <script type="module" src="main.js"></script>
        <script>
            const fillColor = "#ffffff"; // Cambia qui il colore come preferisci

            const svgIcon = `
          <svg fill="${fillColor}" version="1.1" id="Capa_1"
            xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 24 24" xml:space="preserve">
            <g id="SVGRepo_iconCarrier">
              <g>
                <g>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 11C10.8954 11 10 11.8954 10 13C10 14.1046 10.8954 15 12 15C13.1046 15 14 14.1046 14 13C14 11.8954 13.1046 11 12 11Z"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M21.9997 9.50393C21.9997 9.53746 21.9996 9.57132 21.9996 9.60552L21.9996 16.0658C21.9997 16.9523 21.9997 17.7161 21.9175 18.3278C21.8294 18.9833 21.6306 19.6116 21.121 20.1213C20.6113 20.631 19.9829 20.8297 19.3274 20.9178C18.7158 21.0001 17.9519 21 17.0654 21H6.93383C6.04734 21 5.28351 21.0001 4.67185 20.9178C4.01633 20.8297 3.38798 20.631 2.87832 20.1213C2.36866 19.6116 2.16991 18.9833 2.08178 18.3278C1.99954 17.7161 1.99959 16.9523 1.99964 16.0658L1.99964 9.60552C1.99964 9.57132 1.99961 9.53746 1.99957 9.50393C1.99913 9.0428 1.99875 8.64526 2.08406 8.29327C2.3487 7.20148 3.20115 6.34903 4.29295 6.08439C4.64493 5.99908 5.04247 5.99946 5.5036 5.9999C5.53713 5.99994 5.57099 5.99997 5.60519 5.99997C5.95148 5.99997 6.0212 5.99736 6.07751 5.98892C6.30563 5.95473 6.51491 5.84272 6.66991 5.67188C6.70816 5.62971 6.74901 5.57314 6.94109 5.28502L7.16759 4.94527C7.19048 4.91093 7.21314 4.87685 7.23561 4.84304C7.56336 4.34999 7.85245 3.91512 8.2627 3.60547C8.51087 3.41815 8.78666 3.27056 9.08018 3.16797C9.56539 2.99838 10.0876 2.99907 10.6796 2.99986C10.7202 2.99992 10.7612 2.99997 10.8024 2.99997L13.1969 2.99997C13.2381 2.99997 13.2791 2.99992 13.3197 2.99986C13.9117 2.99907 14.4339 2.99838 14.9191 3.16797C15.2126 3.27056 15.4884 3.41815 15.7366 3.60547C16.1468 3.91512 16.4359 4.35 16.7637 4.84304C16.7861 4.87685 16.8088 4.91094 16.8317 4.94527L17.0582 5.28502C17.2503 5.57314 17.2911 5.62971 17.3294 5.67188C17.4844 5.84272 17.6937 5.95473 17.9218 5.98892C17.9781 5.99736 18.0478 5.99997 18.3941 5.99997C18.4283 5.99997 18.4622 5.99994 18.4957 5.9999C18.9568 5.99946 19.3544 5.99908 19.7063 6.08439C20.7981 6.34903 21.6506 7.20148 21.9152 8.29327C22.0005 8.64526 22.0001 9.0428 21.9997 9.50393ZM7.99977 13C7.99977 10.7909 9.79063 9 11.9998 9C14.2089 9 15.9998 10.7909 15.9998 13C15.9998 15.2091 14.2089 17 11.9998 17C9.79063 17 7.99977 15.2091 7.99977 13Z"></path>
                </g>
              </g>
            </g>
          </svg>`;

            const encoded = encodeURIComponent(svgIcon.trim());
            const link = document.createElement("link");
            link.rel = "icon";
            link.type = "image/svg+xml";
            link.href = "data:image/svg+xml," + encoded;

            // Rimuove eventuali favicon già presenti
            const existing = document.querySelectorAll('link[rel="icon"]');
            existing.forEach((el) => el.remove());

            document.head.appendChild(link);
        </script>
    </body>
</html>
